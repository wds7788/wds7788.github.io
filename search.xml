<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Github Pages å’Œ Hexo æ­å»ºåšå®¢</title>
    <url>/2024/12/01/2Github%20PagesHexo/</url>
    <content><![CDATA[<h2 id="åˆ›å»ºä»“åº“"><a href="#åˆ›å»ºä»“åº“" class="headerlink" title="åˆ›å»ºä»“åº“"></a>åˆ›å»ºä»“åº“</h2><ol>
<li>è®¿é—®ï¼š<a href="https://github.com/new">https://github.com/new</a></li>
<li>åˆ›å»ºä»“åº“ï¼Œåç§°å†™ <code>xxx.github.io</code>ã€‚</li>
</ol>
<hr>
<h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><h3 id="1-ä¸‹è½½å®‰è£…-Git-ç¯å¢ƒ"><a href="#1-ä¸‹è½½å®‰è£…-Git-ç¯å¢ƒ" class="headerlink" title="1. ä¸‹è½½å®‰è£… Git ç¯å¢ƒ"></a>1. ä¸‹è½½å®‰è£… Git ç¯å¢ƒ</h3><p>è®¾ç½® GitHub SSH Keyã€‚</p>
<h3 id="2-æ­å»º-Node-js-ç¯å¢ƒ"><a href="#2-æ­å»º-Node-js-ç¯å¢ƒ" class="headerlink" title="2. æ­å»º Node.js ç¯å¢ƒ"></a>2. æ­å»º Node.js ç¯å¢ƒ</h3><p>æ¨èä½¿ç”¨ nvmï¼š<a href="https://cloud.tencent.com/developer/article/1812323">æ–‡ç« é“¾æ¥</a>ã€‚</p>
<hr>
<h2 id="Hexo-çš„ä½¿ç”¨"><a href="#Hexo-çš„ä½¿ç”¨" class="headerlink" title="Hexo çš„ä½¿ç”¨"></a>Hexo çš„ä½¿ç”¨</h2><h3 id="1-å®‰è£…-Hexo"><a href="#1-å®‰è£…-Hexo" class="headerlink" title="1. å®‰è£… Hexo"></a>1. å®‰è£… Hexo</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¿›åº¦æ¡é•¿æ—¶é—´æ²¡æœ‰å˜åŒ–,åˆ‡æ¢åˆ°æ·˜å® NPM é•œåƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npmmirror.com</span><br></pre></td></tr></table></figure>

<h3 id="2-åˆå§‹åŒ–-Hexo-æ¡†æ¶"><a href="#2-åˆå§‹åŒ–-Hexo-æ¡†æ¶" class="headerlink" title="2. åˆå§‹åŒ– Hexo æ¡†æ¶"></a>2. åˆå§‹åŒ– Hexo æ¡†æ¶</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo init blog</span><br></pre></td></tr></table></figure>

<h3 id="3-å®‰è£…ç›¸å…³ä¾èµ–"><a href="#3-å®‰è£…ç›¸å…³ä¾èµ–" class="headerlink" title="3. å®‰è£…ç›¸å…³ä¾èµ–"></a>3. å®‰è£…ç›¸å…³ä¾èµ–</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>

<h3 id="4-å¯åŠ¨æœ¬åœ°æœåŠ¡"><a href="#4-å¯åŠ¨æœ¬åœ°æœåŠ¡" class="headerlink" title="4. å¯åŠ¨æœ¬åœ°æœåŠ¡"></a>4. å¯åŠ¨æœ¬åœ°æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo server</span><br></pre></td></tr></table></figure>
<p>æµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost:4000/">localhost:4000</a>ã€‚</p>
<hr>
<h2 id="é…ç½®-Next-ä¸»é¢˜"><a href="#é…ç½®-Next-ä¸»é¢˜" class="headerlink" title="é…ç½® Next ä¸»é¢˜"></a>é…ç½® Next ä¸»é¢˜</h2><ol>
<li><p>è¿›å…¥ä¸Šä¸€æ­¥åˆ›å»ºçš„ <code>blog</code> æ–‡ä»¶å¤¹ï¼Œå°† Next ä¸»é¢˜ç›¸å…³æ–‡ä»¶ä» GitHub å…‹éš†åˆ° <code>themes</code> æ–‡ä»¶å¤¹ä¸­ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/iissnan/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>
</li>
<li><p>é…ç½® Hexo çš„ä¸»é¢˜å‚æ•°ï¼š</p>
<ul>
<li>ä¿®æ”¹æ ¹ç›®å½•çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­çš„ <code>theme</code> å‚æ•°ä¸ºï¼š<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">theme:</span> <span class="string">next</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>å¯åŠ¨ Hexo æœåŠ¡ï¼ŒéªŒè¯ Next ä¸»é¢˜æ˜¯å¦å¯ç”¨ã€‚</p>
</li>
</ol>
<hr>
<h2 id="æµè§ˆå™¨è®¿é—®-localhost-4000-æ—¶å‡ºé”™"><a href="#æµè§ˆå™¨è®¿é—®-localhost-4000-æ—¶å‡ºé”™" class="headerlink" title="æµè§ˆå™¨è®¿é—® localhost:4000 æ—¶å‡ºé”™"></a>æµè§ˆå™¨è®¿é—® localhost:4000 æ—¶å‡ºé”™</h2><h3 id="é”™è¯¯å†…å®¹"><a href="#é”™è¯¯å†…å®¹" class="headerlink" title="é”™è¯¯å†…å®¹"></a>é”™è¯¯å†…å®¹</h3><p>æµè§ˆå™¨æ˜¾ç¤ºå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% extends &#x27;_layout.swig&#x27; %&#125; &#123;% import &#x27;_macro/post.swig&#x27; as post_template %&#125; &#123;% import &#x27;_macro/sidebar.swig&#x27; as </span><br><span class="line">sidebar_template %&#125; &#123;% block title %&#125;&#123;&#123; config.title &#125;&#125;&#123;% if theme.index_with_subtitle and config.subtitle %&#125; - </span><br><span class="line">&#123;&#123;config.subtitle &#125;&#125;&#123;% endif %&#125;&#123;% endblock %&#125; &#123;%  block page_class %&#125; &#123;% if is_home() %&#125;page-home&#123;% endif -%&#125; &#123;% </span><br><span class="line">endblock %&#125; &#123;% block content %&#125; &#123;% for post in page.posts %&#125; &#123;&#123; post_template.render(post, true) &#125;&#125; &#123;% endfor %&#125; &#123;% </span><br><span class="line">include &#x27;_partials/pagination.swig&#x27; %&#125; &#123;% endblock %&#125; &#123;% block sidebar %&#125; &#123;&#123; sidebar_template.render(false) &#125;&#125; &#123;% </span><br><span class="line">endblock %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>è¿™æ˜¯å› ä¸º Hexo åœ¨ 5.0 ä¹‹ååˆ é™¤äº† <code>swig</code>ï¼Œéœ€è¦è‡ªå·±æ‰‹åŠ¨å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i hexo-renderer-swig</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="æ·»åŠ åšå®¢å†…å®¹"><a href="#æ·»åŠ åšå®¢å†…å®¹" class="headerlink" title="æ·»åŠ åšå®¢å†…å®¹"></a>æ·»åŠ åšå®¢å†…å®¹</h2><ol>
<li>å°†å†™å¥½çš„ Markdown æ”¾åˆ° <code>source/_posts</code> ç›®å½•ã€‚</li>
<li>å°†ç›¸åº”çš„å›¾ç‰‡æ”¾åˆ° <code>source/images</code> ç›®å½•ã€‚</li>
<li>å¯åŠ¨ Hexo æœåŠ¡ï¼ˆå¦‚æœä¹‹å‰æ²¡æœ‰å…³é—­ï¼Œè¯·å¿½ç•¥æ­¤æ­¥éª¤ï¼‰ã€‚</li>
<li>é€šè¿‡æµè§ˆå™¨è®¿é—®åšå®¢ä¸»é¡µï¼Œå¯ä»¥å‘ç°æ›´æ”¹å·²ç”Ÿæ•ˆã€‚</li>
</ol>
<hr>
<h2 id="å°†ç”Ÿæˆçš„é™æ€é¡µé¢éƒ¨ç½²åˆ°-GitHub-ä¸Š"><a href="#å°†ç”Ÿæˆçš„é™æ€é¡µé¢éƒ¨ç½²åˆ°-GitHub-ä¸Š" class="headerlink" title="å°†ç”Ÿæˆçš„é™æ€é¡µé¢éƒ¨ç½²åˆ° GitHub ä¸Š"></a>å°†ç”Ÿæˆçš„é™æ€é¡µé¢éƒ¨ç½²åˆ° GitHub ä¸Š</h2><h3 id="1-å®‰è£…-deploy-git"><a href="#1-å®‰è£…-deploy-git" class="headerlink" title="1. å®‰è£… deploy-git"></a>1. å®‰è£… <code>deploy-git</code></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<h3 id="2-ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶-config-yml-çš„æœ€åéƒ¨åˆ†ï¼š"><a href="#2-ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶-config-yml-çš„æœ€åéƒ¨åˆ†ï¼š" class="headerlink" title="2. ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶ _config.yml çš„æœ€åéƒ¨åˆ†ï¼š"></a>2. ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶ <code>_config.yml</code> çš„æœ€åéƒ¨åˆ†ï¼š</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">https://github.com/YourgithubName/YourgithubName.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">pages</span></span><br></pre></td></tr></table></figure>

<h3 id="3-éƒ¨ç½²åšå®¢"><a href="#3-éƒ¨ç½²åšå®¢" class="headerlink" title="3. éƒ¨ç½²åšå®¢"></a>3. éƒ¨ç½²åšå®¢</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo clean       <span class="comment"># æ¸…é™¤ä¹‹å‰ç”Ÿæˆçš„å†…å®¹</span></span><br><span class="line">hexo generate    <span class="comment"># ç”Ÿæˆé™æ€æ–‡ç« ï¼Œç¼©å†™ hexo g</span></span><br><span class="line">hexo deploy      <span class="comment"># éƒ¨ç½²æ–‡ç« ï¼Œç¼©å†™ hexo d</span></span><br></pre></td></tr></table></figure>

<h3 id="4-è®¾ç½®GitHub-Pages"><a href="#4-è®¾ç½®GitHub-Pages" class="headerlink" title="4. è®¾ç½®GitHub Pages"></a>4. è®¾ç½®GitHub Pages</h3><p>åœ¨ GitHub ä»“åº“Settings Pages Source ä¸º Deploy from a branch ï¼ŒBranché€‰æ‹©pagesåˆ†æ”¯ï¼Œç‚¹å‡»ä¿å­˜save</p>
<hr>
<p>ç°åœ¨ï¼Œä½ å¯ä»¥åœ¨ <a href="http://xxx.github.io/">http://xxx.github.io</a> çœ‹åˆ°ä½ çš„åšå®¢äº†ï¼</p>
]]></content>
  </entry>
  <entry>
    <title>API æ¥å£ç­¾åéªŒè¯æœºåˆ¶</title>
    <url>/2025/05/24/API_interface_signature/</url>
    <content><![CDATA[<h2 id="âœ¨-ä¸€ã€ä»€ä¹ˆæ˜¯-API-æ¥å£ç­¾åéªŒè¯ï¼Ÿ"><a href="#âœ¨-ä¸€ã€ä»€ä¹ˆæ˜¯-API-æ¥å£ç­¾åéªŒè¯ï¼Ÿ" class="headerlink" title="âœ¨ ä¸€ã€ä»€ä¹ˆæ˜¯ API æ¥å£ç­¾åéªŒè¯ï¼Ÿ"></a>âœ¨ ä¸€ã€ä»€ä¹ˆæ˜¯ API æ¥å£ç­¾åéªŒè¯ï¼Ÿ</h2><p>API ç­¾åæ˜¯ä¸€ç§ä¿éšœæ¥å£å®‰å…¨æ€§çš„æœºåˆ¶ã€‚å…¶æ ¸å¿ƒç›®çš„æ˜¯ï¼š</p>
<ul>
<li>é˜²ç¯¡æ”¹<strong>ç¡®ä¿è¯·æ±‚å†…å®¹æœªè¢«ç¬¬ä¸‰æ–¹ä¿®æ”¹</strong></li>
<li>é˜²ä¼ªé€ <strong>éªŒè¯è¯·æ±‚æ¥æºåˆæ³•æ€§</strong></li>
<li>æ—¶æ•ˆæ€§<strong>é˜²æ­¢å†å²è¯·æ±‚é‡å¤æäº¤</strong></li>
<li>å®Œæ•´æ€§<strong>ä¿è¯ä¼ è¾“è¿‡ç¨‹æ•°æ®å®Œæ•´</strong></li>
</ul>
<p>ç­¾åçš„åŸºæœ¬åŸç†æ˜¯ï¼šå®¢æˆ·ç«¯å°†çº¦å®šå‚æ•°+è¯·æ±‚ä½“ + å¯†é’¥åšåŠ å¯†ç­¾åï¼ŒæœåŠ¡å™¨æ ¹æ®ç›¸åŒé€»è¾‘é‡æ–°ç”Ÿæˆç­¾åè¿›è¡Œæ¯”å¯¹ï¼Œä»è€Œæ ¡éªŒè¯·æ±‚åˆæ³•æ€§ã€‚</p>
<hr>
<h2 id="ğŸ“-äºŒã€ç­¾åå‚æ•°è®¾è®¡"><a href="#ğŸ“-äºŒã€ç­¾åå‚æ•°è®¾è®¡" class="headerlink" title="ğŸ“ äºŒã€ç­¾åå‚æ•°è®¾è®¡"></a>ğŸ“ äºŒã€ç­¾åå‚æ•°è®¾è®¡</h2><p>ä¸€èˆ¬åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªå­—æ®µï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>X-App-Id</code></td>
<td>åº”ç”¨æ ‡è¯†ï¼ˆå®¢æˆ·ç«¯IDï¼‰</td>
</tr>
<tr>
<td><code>X-Version</code></td>
<td>APIç‰ˆæœ¬å·</td>
</tr>
<tr>
<td><code>X-Timestamp</code></td>
<td>è¯·æ±‚æ—¶é—´æˆ³ï¼ˆå•ä½ç§’ï¼‰</td>
</tr>
<tr>
<td><code>X-Nonce</code></td>
<td>éšæœºå­—ç¬¦ä¸²ï¼ˆé˜²é‡æ”¾ï¼‰</td>
</tr>
<tr>
<td><code>X-Signature</code></td>
<td>ç­¾åå€¼ï¼ˆHMAC-SHA256ç”Ÿæˆï¼‰</td>
</tr>
</tbody></table>
<p>è¯·æ±‚ä½“ï¼ˆbodyï¼‰ä¹Ÿä¼šä½œä¸ºç­¾åçš„ä¸€éƒ¨åˆ†å‚ä¸è®¡ç®—ã€‚</p>
<h3 id="ç­¾åç”Ÿæˆæ­¥éª¤"><a href="#ç­¾åç”Ÿæˆæ­¥éª¤" class="headerlink" title="ç­¾åç”Ÿæˆæ­¥éª¤"></a>ç­¾åç”Ÿæˆæ­¥éª¤</h3><ol>
<li><strong>å‚æ•°æ”¶é›†</strong>: æ”¶é›†æ‰€æœ‰å‚ä¸ç­¾åçš„å‚æ•°</li>
<li><strong>å‚æ•°æ’åº</strong>: æŒ‰å‚æ•°åè¿›è¡Œå­—å…¸åºæ’åˆ—</li>
<li><strong>å­—ç¬¦ä¸²æ‹¼æ¥</strong>: æŒ‰<code>key=value&amp;</code>æ ¼å¼æ‹¼æ¥</li>
<li><strong>HMACç­¾å</strong>: ä½¿ç”¨HMAC-SHA256ç®—æ³•è®¡ç®—ç­¾å</li>
</ol>
<h3 id="ç®—æ³•ç¤ºä¾‹"><a href="#ç®—æ³•ç¤ºä¾‹" class="headerlink" title="ç®—æ³•ç¤ºä¾‹"></a>ç®—æ³•ç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŸå§‹å‚æ•°ï¼š</span><br><span class="line">appid=appId</span><br><span class="line">version=1.0.0</span><br><span class="line">timestamp=1716456789</span><br><span class="line">nonce=abc123</span><br><span class="line">body=&#123;&quot;userId&quot;:123,&quot;action&quot;:&quot;testAction&quot;&#125;</span><br><span class="line">secretKey=secretKey</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šbodyå¦‚æœä¸ºç©ºå°±èµ‹å€¼&quot;&#123;&#125;&quot;,body=&#123;&#125;</span><br><span class="line"></span><br><span class="line">å°†è¯·æ±‚ä½“ï¼ˆå¦‚ JSONï¼‰åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œå¿½ç•¥undefinedã€functionç­‰éæ³•ç±»å‹</span><br><span class="line"></span><br><span class="line">æŒ‰å‚æ•°åå­—æ¯åºæ’åºï¼ˆå¦‚appidâ†’bodyâ†’nonceâ†’timestampâ†’versionï¼‰</span><br><span class="line"></span><br><span class="line">ç”Ÿæˆç­¾åå­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">æ‹¼æ¥ä¸ºkey1=value1&amp;key2=value2&amp;...æ ¼å¼</span><br><span class="line"></span><br><span class="line">æ’åºåæ‹¼æ¥ï¼š</span><br><span class="line">appid=appId&amp;body=&#123;&quot;userId&quot;:123,&quot;action&quot;:&quot;testAction&quot;&#125;&amp;nonce=abc123&amp;timestamp=1716456789&amp;version=1.0.0</span><br><span class="line"></span><br><span class="line">HMAC-SHA256ç­¾åï¼š</span><br><span class="line">signature = HMAC-SHA256(æ‹¼æ¥å­—ç¬¦ä¸², secretKey)</span><br><span class="line"></span><br><span class="line">signatureç¤ºä¾‹: c8313008af78b064d700de24c5d15cee2ab6a14e6f506930656faa73668419f4</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”-ä¸‰ã€ä»£ç ç¤ºä¾‹"><a href="#ğŸ”-ä¸‰ã€ä»£ç ç¤ºä¾‹" class="headerlink" title="ğŸ” ä¸‰ã€ä»£ç ç¤ºä¾‹"></a>ğŸ” ä¸‰ã€ä»£ç ç¤ºä¾‹</h2><h3 id="å‰ç«¯åŠ ç­¾é€»è¾‘ï¼ˆJavaScriptï¼‰"><a href="#å‰ç«¯åŠ ç­¾é€»è¾‘ï¼ˆJavaScriptï¼‰" class="headerlink" title="å‰ç«¯åŠ ç­¾é€»è¾‘ï¼ˆJavaScriptï¼‰"></a>å‰ç«¯åŠ ç­¾é€»è¾‘ï¼ˆJavaScriptï¼‰</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ç­¾åæµ‹è¯•<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;sendRequest()&quot;</span>&gt;</span>å‘é€è¯·æ±‚<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> config = &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">appId</span>: <span class="string">&quot;appId&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">secretKey</span>: <span class="string">&quot;secretKey&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">version</span>: <span class="string">&quot;1.0.0&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">apiUrl</span>: <span class="string">&quot;https://wds7788.github.io/api/v1/test/test&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">generateSignature</span>(<span class="params">config, data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> timestamp = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> nonce = <span class="title function_">generateUniqueId</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// ä¿æŒåŸå§‹JSONé¡ºåº</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> bodyStr = data ? <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data, jsonSafeReplacer) : <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> signParams = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">appid</span>: config.<span class="property">appId</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">version</span>: config.<span class="property">version</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">timestamp</span>: timestamp,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">nonce</span>: nonce,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">body</span>: bodyStr</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è°ƒè¯•è¾“å‡ºï¼ˆå®Œæˆåå¯ç§»é™¤ï¼‰</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å‚ä¸ç­¾åå‚æ•°:&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(signParams, <span class="literal">null</span>, <span class="number">2</span>));</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> sortedParams = <span class="title class_">Object</span>.<span class="title function_">keys</span>(signParams)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">sort</span>()</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;signParams[key]&#125;</span>`</span>)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è°ƒè¯•è¾“å‡º</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç­¾åå­—ç¬¦ä¸²:&#x27;</span>, sortedParams);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> signature = <span class="title class_">CryptoJS</span>.<span class="title class_">HmacSHA256</span>(</span></span><br><span class="line"><span class="language-javascript">            sortedParams,</span></span><br><span class="line"><span class="language-javascript">            config.<span class="property">secretKey</span></span></span><br><span class="line"><span class="language-javascript">        ).<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Hex</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;signature:&#x27;</span>, signature);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&#x27;X-App-Id&#x27;</span>: config.<span class="property">appId</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&#x27;X-Version&#x27;</span>: config.<span class="property">version</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&#x27;X-Timestamp&#x27;</span>: timestamp,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&#x27;X-Nonce&#x27;</span>: nonce,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&#x27;X-Signature&#x27;</span>: signature</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">body</span>: bodyStr</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">generateUniqueId</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> length = <span class="number">12</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> characters = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> result = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> charactersLength = characters.<span class="property">length</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">            result += characters.<span class="title function_">charAt</span>(<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * charactersLength));</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> result;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">jsonSafeReplacer</span>(<span class="params">key, value</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;bigint&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> value.<span class="title function_">toString</span>(); <span class="comment">// BigInt è½¬ä¸ºå­—ç¬¦ä¸²</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;symbol&#x27;</span> || <span class="keyword">typeof</span> value === <span class="string">&#x27;function&#x27;</span> || <span class="keyword">typeof</span> value === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="literal">undefined</span>; <span class="comment">// å¿½ç•¥ Symbolã€Functionã€undefined</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> value;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sendRequest</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> requestData = &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">userId</span>: <span class="number">123</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">action</span>: <span class="string">&#x27;testAction&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> &#123;headers, body&#125; = <span class="title function_">generateSignature</span>(config, requestData);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// è°ƒè¯•è¾“å‡º</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æœ€ç»ˆè¯·æ±‚å¤´:&#x27;</span>, headers);</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯·æ±‚ä½“:&#x27;</span>, body);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">post</span>(config.<span class="property">apiUrl</span>, body, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    ...headers,</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯·æ±‚æˆåŠŸ:&#x27;</span>, response.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯·æ±‚å¤±è´¥:&#x27;</span>, error);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">sendRequest</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="åç«¯éªŒç­¾é€»è¾‘ï¼ˆPHPï¼‰"><a href="#åç«¯éªŒç­¾é€»è¾‘ï¼ˆPHPï¼‰" class="headerlink" title="åç«¯éªŒç­¾é€»è¾‘ï¼ˆPHPï¼‰"></a>åç«¯éªŒç­¾é€»è¾‘ï¼ˆPHPï¼‰</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: wds</span></span><br><span class="line"><span class="comment"> * Date: 2025/5/23</span></span><br><span class="line"><span class="comment"> * Time: 16:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">utils</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Signature</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$expireTime</span> = <span class="number">600</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$appId</span>      = <span class="string">&quot;appId&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$secretKey</span>  = <span class="string">&quot;secretKey&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$success</span>    = <span class="number">200</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$error</span>      = <span class="number">400</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ£€éªŒsignæ˜¯å¦æ­£ç¡®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verifySign</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$header</span>, <span class="keyword">string</span> <span class="variable">$body</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// è·å–è¯·æ±‚å¤´å‚æ•°</span></span><br><span class="line">        <span class="variable">$appid</span>     = <span class="variable">$header</span>[<span class="string">&#x27;X-App-Id&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable">$version</span>   = <span class="variable">$header</span>[<span class="string">&#x27;X-Version&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable">$nonce</span>     = <span class="variable">$header</span>[<span class="string">&#x27;X-Nonce&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable">$timestamp</span> = <span class="variable">$header</span>[<span class="string">&#x27;X-Timestamp&#x27;</span>] ?? <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$signature</span> = <span class="variable">$header</span>[<span class="string">&#x27;X-Signature&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŸºç¡€éªŒè¯</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$appid</span> || !<span class="variable">$version</span> || !<span class="variable">$nonce</span> || !<span class="variable">$timestamp</span> || !<span class="variable">$signature</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> [<span class="string">&#x27;code&#x27;</span> =&gt; <span class="variable language_">$this</span>-&gt;error, <span class="string">&#x27;msg&#x27;</span> =&gt; <span class="string">&#x27;Missing authentication headers&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åº”ç”¨IDæœ‰æ•ˆæ€§éªŒè¯</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$appid</span> !== <span class="variable language_">$this</span>-&gt;appId) &#123;</span><br><span class="line">            <span class="keyword">return</span> [<span class="string">&#x27;code&#x27;</span> =&gt; <span class="variable language_">$this</span>-&gt;error, <span class="string">&#x27;msg&#x27;</span> =&gt; <span class="string">&#x27;Invalid appid&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ—¶é—´æœ‰æ•ˆæ€§éªŒè¯</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">time</span>() - <span class="variable">$timestamp</span> &gt; <span class="variable language_">$this</span>-&gt;expireTime) &#123;</span><br><span class="line">            <span class="keyword">return</span> [<span class="string">&#x27;code&#x27;</span> =&gt; <span class="variable language_">$this</span>-&gt;error, <span class="string">&#x27;msg&#x27;</span> =&gt; <span class="string">&#x27;Request expired&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Nonceé˜²é‡æ”¾</span></span><br><span class="line">        <span class="comment">// if (Cache::has(&#x27;api_nonce:&#x27;.$nonce)) &#123;</span></span><br><span class="line">        <span class="comment">//     throw new \Exception(&#x27;Duplicate request&#x27;, 401);</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">//Cache::set(&#x27;api_nonce:&#x27;.$nonce, 1, $this-&gt;expireTime);</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$body</span>)) &#123;</span><br><span class="line">            <span class="variable">$body</span> = <span class="string">&quot;&#123;&#125;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”ŸæˆæœåŠ¡ç«¯ç­¾å</span></span><br><span class="line">        <span class="variable">$serverSign</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">generateSign</span>([</span><br><span class="line">            <span class="string">&#x27;appid&#x27;</span>     =&gt; <span class="variable">$appid</span>,</span><br><span class="line">            <span class="string">&#x27;version&#x27;</span>   =&gt; <span class="variable">$version</span>,</span><br><span class="line">            <span class="string">&#x27;timestamp&#x27;</span> =&gt; <span class="variable">$timestamp</span>,</span><br><span class="line">            <span class="string">&#x27;nonce&#x27;</span>     =&gt; <span class="variable">$nonce</span>,</span><br><span class="line">            <span class="string">&#x27;body&#x27;</span>      =&gt; <span class="variable">$body</span> // è¯·æ±‚ä½“</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç­¾åæ¯”å¯¹</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">hash_equals</span>(<span class="variable">$serverSign</span>, <span class="variable">$signature</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> [<span class="string">&#x27;code&#x27;</span> =&gt; <span class="variable language_">$this</span>-&gt;error, <span class="string">&#x27;msg&#x27;</span> =&gt; <span class="string">&#x27;Invalid signature&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;code&#x27;</span> =&gt; <span class="variable language_">$this</span>-&gt;success, <span class="string">&#x27;msg&#x27;</span> =&gt; <span class="string">&#x27;success&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">generateSign</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$params</span></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// å‚æ•°æ’åº</span></span><br><span class="line">        <span class="title function_ invoke__">ksort</span>(<span class="variable">$params</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‹¼æ¥å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="variable">$signStr</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$params</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">            <span class="variable">$signStr</span> .= <span class="string">&quot;<span class="subst">&#123;$key&#125;</span>=<span class="subst">&#123;$value&#125;</span>&amp;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$signStr</span> = <span class="title function_ invoke__">rtrim</span>(<span class="variable">$signStr</span>, <span class="string">&#x27;&amp;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨HMAC-SHA256</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">hash_hmac</span>(<span class="string">&#x27;sha256&#x27;</span>, <span class="variable">$signStr</span>, <span class="variable">$this</span>-&gt;secretKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>æ‰‹åŠ¨ç¼–è¯‘å®‰è£…Swooleæ‰©å±•</title>
    <url>/2025/04/20/install_swoole_extension/</url>
    <content><![CDATA[<h3 id="swoole-curl-setopt-option-10100-is-not-supportedè§£å†³"><a href="#swoole-curl-setopt-option-10100-is-not-supportedè§£å†³" class="headerlink" title="swoole_curl_setopt(): option[10100] is not supportedè§£å†³"></a>swoole_curl_setopt(): option[10100] is not supportedè§£å†³</h3><h3 id="å®‰è£…-Swoole-æ‰©å±•å¹¶å¯ç”¨-CURL-æ”¯æŒ"><a href="#å®‰è£…-Swoole-æ‰©å±•å¹¶å¯ç”¨-CURL-æ”¯æŒ" class="headerlink" title="å®‰è£… Swoole æ‰©å±•å¹¶å¯ç”¨ CURL æ”¯æŒ"></a>å®‰è£… Swoole æ‰©å±•å¹¶å¯ç”¨ CURL æ”¯æŒ</h3><p>åœ¨å®å¡”é¢æ¿ä¸­ï¼ŒPHP é€šå¸¸ä½äº <code>/www/server/php/ä½ çš„PHPç‰ˆæœ¬/bin</code> ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ <code>/www/server/php/82/bin/phpize</code>ã€‚ä½ éœ€è¦æ ¹æ®ä½ å®‰è£…çš„ PHP ç‰ˆæœ¬è°ƒæ•´å‘½ä»¤ã€‚</p>
<h4 id="1-ä¸‹è½½-Swoole-æºç "><a href="#1-ä¸‹è½½-Swoole-æºç " class="headerlink" title="1. ä¸‹è½½ Swoole æºç "></a>1. <strong>ä¸‹è½½ Swoole æºç </strong></h4><p>ä» <a href="https://github.com/swoole/swoole-src/releases">Swoole GitHub</a> ä¸‹è½½æœ€æ–°çš„æºç åŒ…ã€‚é€‰æ‹© <code>Source code(tar.gz)</code> æ ¼å¼çš„æ–‡ä»¶è¿›è¡Œä¸‹è½½ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://github.com/swoole/swoole-src/archive/refs/tags/v6.0.2.tar.gz</span><br></pre></td></tr></table></figure>

<h4 id="2-è§£å‹æºç åŒ…"><a href="#2-è§£å‹æºç åŒ…" class="headerlink" title="2. è§£å‹æºç åŒ…"></a>2. <strong>è§£å‹æºç åŒ…</strong></h4><p>å‡è®¾ä½ å·²ç»ä¸‹è½½äº† <code>swoole-src-6.0.2.tar.gz</code> æ–‡ä»¶ï¼Œé¦–å…ˆè¿›å…¥ PHP å®‰è£…ç›®å½•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /www/server/php/82</span><br></pre></td></tr></table></figure>

<p>ç„¶åè§£å‹ä¸‹è½½çš„ Swoole æºç åŒ…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf swoole-src-6.0.2.tar.gz</span><br></pre></td></tr></table></figure>

<h4 id="3-è¿›å…¥æºç ç›®å½•"><a href="#3-è¿›å…¥æºç ç›®å½•" class="headerlink" title="3. è¿›å…¥æºç ç›®å½•"></a>3. <strong>è¿›å…¥æºç ç›®å½•</strong></h4><p>è§£å‹åï¼Œè¿›å…¥ Swoole æºç ç›®å½•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> swoole-src-6.0.2</span><br></pre></td></tr></table></figure>

<h4 id="4-æ‰§è¡Œ-phpize"><a href="#4-æ‰§è¡Œ-phpize" class="headerlink" title="4. æ‰§è¡Œ phpize"></a>4. <strong>æ‰§è¡Œ phpize</strong></h4><p>åœ¨ç¼–è¯‘ Swoole æ‰©å±•ä¹‹å‰ï¼Œéœ€è¦å…ˆæ‰§è¡Œ <code>phpize</code> å‘½ä»¤æ¥å‡†å¤‡ PHP æ‰©å±•çš„ç¼–è¯‘ç¯å¢ƒã€‚<code>phpize</code> æ˜¯ PHP æä¾›çš„ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºå‡†å¤‡ PHP æ‰©å±•çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œç”Ÿæˆå¿…è¦çš„é…ç½®æ–‡ä»¶ã€‚æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/www/server/php/82/bin/phpize</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>åŸç†</strong>ï¼š<code>phpize</code>æ˜¯PHPæ‰©å±•å¼€å‘å·¥å…·ï¼Œä½œç”¨æ˜¯å°†Swooleæºç è½¬æ¢ä¸ºPHPå¯è¯†åˆ«çš„æ‰©å±•æ¨¡å—ã€‚éœ€ä½¿ç”¨å¯¹åº”PHPç‰ˆæœ¬çš„phpizeï¼Œå¦åˆ™ä¼šå‡ºç°ABIç‰ˆæœ¬ä¸åŒ¹é…é”™è¯¯ã€‚<code>phpize</code> ä¼šæ£€æµ‹å½“å‰çš„ PHP ç¯å¢ƒå¹¶ç”Ÿæˆä¸€ä¸ª <code>configure</code> è„šæœ¬ï¼Œä½¿å¾— Swoole èƒ½å¤Ÿä¸ PHP æ­£å¸¸å…¼å®¹ã€‚</p>
</blockquote>
<h4 id="5-é…ç½®ç¼–è¯‘é€‰é¡¹"><a href="#5-é…ç½®ç¼–è¯‘é€‰é¡¹" class="headerlink" title="5. é…ç½®ç¼–è¯‘é€‰é¡¹"></a>5. <strong>é…ç½®ç¼–è¯‘é€‰é¡¹</strong></h4><p>æ‰§è¡Œ <code>configure</code> å‘½ä»¤æ—¶ï¼ŒåŠ å…¥ <code>--enable-swoole-curl</code> å‚æ•°æ¥å¯ç”¨åŸç”Ÿçš„ CURL æ”¯æŒã€‚å¹¶é€šè¿‡ <code>--with-php-config</code> æŒ‡å®š PHP é…ç½®å·¥å…·çš„è·¯å¾„ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./configure --enable-swoole-curl --enable-openssl --with-php-config=/www/server/php/82/bin/php-config</span><br><span class="line">  make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>åŸç†</strong>ï¼š<code>--enable-swoole-curl</code> å‚æ•°å¯ç”¨äº† Swoole æ‰©å±•ä¸­çš„ CURL æ”¯æŒï¼Œ<code>--with-php-config</code> åˆ™æŒ‡å®šäº† PHP é…ç½®å·¥å…·çš„è·¯å¾„ï¼Œç¡®ä¿ç¼–è¯‘è¿‡ç¨‹ä¸­ PHP çš„æ­£ç¡®é…ç½®,é€šè¿‡configureè„šæœ¬ç”ŸæˆMakefileï¼Œå‚æ•°å†³å®šæ‰©å±•åŠŸèƒ½å’Œä¾èµ–åº“ç»‘å®šæ–¹å¼ã€‚ä½¿ç”¨ç³»ç»ŸCURLå¯é¿å…è‡ªç ”å®ç°çš„å…¼å®¹æ€§é—®é¢˜ã€‚</p>
</blockquote>
<h4 id="6-ç¼–è¯‘å’Œå®‰è£…"><a href="#6-ç¼–è¯‘å’Œå®‰è£…" class="headerlink" title="6. ç¼–è¯‘å’Œå®‰è£…"></a>6. <strong>ç¼–è¯‘å’Œå®‰è£…</strong></h4><p>å®Œæˆé…ç½®åï¼Œæ‰§è¡Œ <code>make</code> å’Œ <code>make install</code> å‘½ä»¤æ¥ç¼–è¯‘å¹¶å®‰è£… Swoole æ‰©å±•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>åŸç†</strong>ï¼š<code>make</code> ä¼šç¼–è¯‘ Swoole æ‰©å±•ï¼Œ<code>make install</code> ä¼šå°†ç¼–è¯‘å¥½çš„æ‰©å±•å®‰è£…åˆ° PHP æ‰©å±•ç›®å½•ä¸­ã€‚å¦‚æœç¼–è¯‘é¡ºåˆ©ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼Œè¡¨ç¤ºå®‰è£…æˆåŠŸã€‚</p>
</blockquote>
<p>å¦‚æœç¼–è¯‘æ—¶æç¤ºç¼ºå°‘ OpenSSL å¼€å‘åº“ï¼Œéœ€è¦å…ˆå®‰è£…ï¼š</p>
<p>CentOS&#x2F;RHEL:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install openssl-devel</span><br></pre></td></tr></table></figure>

<p>Ubuntu&#x2F;Debian:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt-get install libssl-dev</span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>/www/server/php/82/lib/php/extensions/no-debug-non-zts-20220829</code> ç›®å½•ä¸‹ï¼Œä½ ä¼šçœ‹åˆ° <code>swoole.so</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /www/server/php/82/lib/php/extensions/no-debug-non-zts-20220829</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fileinfo.so  igbinary.so  opcache.so  redis.so  swoole.so  zip.so</span><br></pre></td></tr></table></figure>

<h4 id="7-ä¿®æ”¹-PHP-é…ç½®æ–‡ä»¶"><a href="#7-ä¿®æ”¹-PHP-é…ç½®æ–‡ä»¶" class="headerlink" title="7. ä¿®æ”¹ PHP é…ç½®æ–‡ä»¶"></a>7. <strong>ä¿®æ”¹ PHP é…ç½®æ–‡ä»¶</strong></h4><p>åœ¨ PHP é…ç½®æ–‡ä»¶ä¸­åŠ è½½ Swoole æ‰©å±•ã€‚ç¼–è¾‘ PHP 8.2 çš„ <code>php.ini</code> æ–‡ä»¶ï¼Œé€šå¸¸ä½äº <code>/www/server/php/82/etc/php.ini</code>ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">extension=swoole.so</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>åŸç†</strong>ï¼šè¿™è¡Œé…ç½®æŒ‡ç¤º PHP åŠ è½½ <code>swoole.so</code> æ‰©å±•ï¼Œä»¥ä¾¿ Swoole æ‰©å±•èƒ½å¤Ÿåœ¨ PHP ä¸­ç”Ÿæ•ˆã€‚</p>
</blockquote>
<h4 id="8-é‡å¯-PHP-æœåŠ¡"><a href="#8-é‡å¯-PHP-æœåŠ¡" class="headerlink" title="8. é‡å¯ PHP æœåŠ¡"></a>8. <strong>é‡å¯ PHP æœåŠ¡</strong></h4><p>ä¿®æ”¹å®Œ <code>php.ini</code> æ–‡ä»¶åï¼Œé‡å¯ PHP æœåŠ¡ä»¥åº”ç”¨æ›´æ”¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service php-fpm restart</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…é€šè¿‡å®å¡”é¢æ¿é‡å¯ PHP æœåŠ¡ã€‚</p>
<h4 id="9-éªŒè¯å®‰è£…"><a href="#9-éªŒè¯å®‰è£…" class="headerlink" title="9. éªŒè¯å®‰è£…"></a>9. <strong>éªŒè¯å®‰è£…</strong></h4><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¡®è®¤ Swoole æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">php -m | grep swoole</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¾“å‡º <code>swoole</code>ï¼Œè¯´æ˜å®‰è£…æˆåŠŸã€‚</p>
<p>éªŒè¯æ˜¯å¦æˆåŠŸå¯ç”¨ OpenSSLï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">php --ri swoole | grep openssl</span><br></pre></td></tr></table></figure>

<p>åº”è¯¥èƒ½çœ‹åˆ° openssl support &#x3D;&gt; enabled çš„è¾“å‡ºã€‚</p>
<hr>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œä½ å°±èƒ½æˆåŠŸåœ°ç¼–è¯‘å¹¶å®‰è£…å¸¦æœ‰ CURL æ”¯æŒçš„ Swoole æ‰©å±•ã€‚é‡è¦çš„æ˜¯ï¼Œç¡®ä¿åœ¨ <code>configure</code> å‘½ä»¤ä¸­æ·»åŠ äº† <code>--enable-swoole-curl</code> å‚æ•°ï¼Œè¿™æ ·å¯ä»¥å¯ç”¨åŸç”Ÿ CURL æ”¯æŒã€‚ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œ<code>phpize</code> å’Œ <code>php-config</code> å·¥å…·çš„ä½¿ç”¨éå¸¸å…³é”®ï¼Œå®ƒä»¬å¸®åŠ©ä½ ç¡®ä¿æ‰©å±•èƒ½å¤Ÿæ­£ç¡®ç¼–è¯‘å¹¶ä¸ PHP é…ç½®å…¼å®¹ã€‚</p>
<p>å¦‚é‡åˆ°ç¼–è¯‘é”™è¯¯ï¼Œè¯·æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å®‰è£… PHP å¼€å‘åŒ…å’Œç›¸å…³ä¾èµ–åº“ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>ThinkPHP 8.1 + think-swoole 4.1 çš„ WebSocket å®æ—¶é€šä¿¡</title>
    <url>/2025/06/06/tp8_think_swoole_websock/</url>
    <content><![CDATA[<hr>
<h1 id="ğŸŒ-ä½¿ç”¨-Swoole-å¼€å¯-WebSocket-æœåŠ¡ï¼ˆå«è¿æ¥-æ¶ˆæ¯-æ–­å¼€ç›‘å¬ï¼‰"><a href="#ğŸŒ-ä½¿ç”¨-Swoole-å¼€å¯-WebSocket-æœåŠ¡ï¼ˆå«è¿æ¥-æ¶ˆæ¯-æ–­å¼€ç›‘å¬ï¼‰" class="headerlink" title="ğŸŒ ä½¿ç”¨ Swoole å¼€å¯ WebSocket æœåŠ¡ï¼ˆå«è¿æ¥&#x2F;æ¶ˆæ¯&#x2F;æ–­å¼€ç›‘å¬ï¼‰"></a>ğŸŒ ä½¿ç”¨ Swoole å¼€å¯ WebSocket æœåŠ¡ï¼ˆå«è¿æ¥&#x2F;æ¶ˆæ¯&#x2F;æ–­å¼€ç›‘å¬ï¼‰</h1><p>æœ¬æ–‡å°†é€šè¿‡ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œä»‹ç»å¦‚ä½•åŸºäº Swoole å’Œ ThinkPHP 8 é…ç½® WebSocket æœåŠ¡ï¼ŒåŒ…å«æœåŠ¡å¯åŠ¨ã€è¿æ¥äº‹ä»¶ç›‘å¬ã€æ¶ˆæ¯å¤„ç†ã€æ–­å¼€å¤„ç†åŠå‰ç«¯ç¤ºä¾‹ï¼Œé€‚åˆåˆå­¦è€…å¿«é€Ÿä¸Šæ‰‹ã€‚</p>
<p>æ¡†æ¶ï¼šthinkphp:8.1.1</p>
<p>æ‰©å±•ï¼šthink-swoole:4.1</p>
<hr>
<h2 id="ğŸ“¦-ä¸€ã€Swoole-é…ç½®æ–‡ä»¶ï¼ˆæ”¯æŒ-WebSocketï¼‰"><a href="#ğŸ“¦-ä¸€ã€Swoole-é…ç½®æ–‡ä»¶ï¼ˆæ”¯æŒ-WebSocketï¼‰" class="headerlink" title="ğŸ“¦ ä¸€ã€Swoole é…ç½®æ–‡ä»¶ï¼ˆæ”¯æŒ WebSocketï¼‰"></a>ğŸ“¦ ä¸€ã€Swoole é…ç½®æ–‡ä»¶ï¼ˆæ”¯æŒ WebSocketï¼‰</h2><p>åˆ›å»ºæˆ–ä¿®æ”¹ä½ çš„ <code>config/swoole.php</code> é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;enable&#x27;</span>     =&gt; <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&#x27;host&#x27;</span>       =&gt; <span class="string">&#x27;0.0.0.0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;port&#x27;</span>       =&gt; <span class="number">9501</span>, <span class="comment">// ä¿®æ”¹ä¸ºä½ çš„ç«¯å£</span></span><br><span class="line">        <span class="string">&#x27;worker_num&#x27;</span> =&gt; <span class="title function_ invoke__">swoole_cpu_num</span>(),</span><br><span class="line">        <span class="string">&#x27;options&#x27;</span>    =&gt; [</span><br><span class="line">            <span class="string">&#x27;package_max_length&#x27;</span> =&gt; <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>, <span class="comment">// 10MB</span></span><br><span class="line">            <span class="string">&#x27;max_request&#x27;</span>        =&gt; <span class="number">3000</span>,</span><br><span class="line">        ],</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;websocket&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;enable&#x27;</span>        =&gt; <span class="literal">true</span>, <span class="comment">// å¼€å¯ WebSocket</span></span><br><span class="line">        <span class="string">&#x27;route&#x27;</span>         =&gt; <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&#x27;handler&#x27;</span>       =&gt; \think\swoole\websocket<span class="title class_">\Handler</span>::<span class="variable language_">class</span>,</span><br><span class="line">        <span class="string">&#x27;ping_interval&#x27;</span> =&gt; <span class="number">25000</span>, <span class="comment">// å¿ƒè·³é—´éš”</span></span><br><span class="line">        <span class="string">&#x27;ping_timeout&#x27;</span>  =&gt; <span class="number">60000</span>, <span class="comment">// è¶…æ—¶æ—¶é—´</span></span><br><span class="line">        <span class="string">&#x27;room&#x27;</span> =&gt; [</span><br><span class="line">            <span class="string">&#x27;type&#x27;</span>  =&gt; <span class="string">&#x27;table&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;table&#x27;</span> =&gt; [</span><br><span class="line">                <span class="string">&#x27;room_rows&#x27;</span>   =&gt; <span class="number">8192</span>,</span><br><span class="line">                <span class="string">&#x27;room_size&#x27;</span>   =&gt; <span class="number">2048</span>,</span><br><span class="line">                <span class="string">&#x27;client_rows&#x27;</span> =&gt; <span class="number">4096</span>,</span><br><span class="line">                <span class="string">&#x27;client_size&#x27;</span> =&gt; <span class="number">2048</span>,</span><br><span class="line">            ],</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line">        <span class="comment">// WebSocket äº‹ä»¶ç›‘å¬ç±»</span></span><br><span class="line">        <span class="string">&#x27;listen&#x27;</span> =&gt; [</span><br><span class="line">            <span class="string">&#x27;open&#x27;</span>  =&gt; \app\webscoket<span class="title class_">\Connect</span>::<span class="variable language_">class</span>,</span><br><span class="line">            <span class="string">&#x27;event&#x27;</span> =&gt; \app\webscoket<span class="title class_">\Event</span>::<span class="variable language_">class</span>,</span><br><span class="line">            <span class="string">&#x27;close&#x27;</span> =&gt; \app\webscoket<span class="title class_">\Close</span>::<span class="variable language_">class</span>,</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line">        <span class="string">&#x27;subscribe&#x27;</span> =&gt; [],</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–æœåŠ¡é…ç½®ï¼ˆå¯æŒ‰éœ€å¯ç”¨ï¼‰</span></span><br><span class="line">    <span class="string">&#x27;rpc&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;server&#x27;</span> =&gt; [</span><br><span class="line">            <span class="string">&#x27;enable&#x27;</span>     =&gt; <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&#x27;host&#x27;</span>       =&gt; <span class="string">&#x27;0.0.0.0&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;port&#x27;</span>       =&gt; <span class="number">9000</span>,</span><br><span class="line">            <span class="string">&#x27;worker_num&#x27;</span> =&gt; <span class="title function_ invoke__">swoole_cpu_num</span>(),</span><br><span class="line">            <span class="string">&#x27;services&#x27;</span>   =&gt; [],</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;client&#x27;</span> =&gt; [],</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;queue&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;enable&#x27;</span>  =&gt; <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&#x27;workers&#x27;</span> =&gt; [],</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;hot_update&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;enable&#x27;</span>  =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;APP_DEBUG&#x27;</span>, <span class="literal">false</span>),</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>    =&gt; [<span class="string">&#x27;*.php&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;include&#x27;</span> =&gt; [<span class="title function_ invoke__">app_path</span>()],</span><br><span class="line">        <span class="string">&#x27;exclude&#x27;</span> =&gt; [],</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;pool&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;db&#x27;</span> =&gt; [</span><br><span class="line">            <span class="string">&#x27;enable&#x27;</span>        =&gt; <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&#x27;max_active&#x27;</span>    =&gt; <span class="number">3</span>,</span><br><span class="line">            <span class="string">&#x27;max_wait_time&#x27;</span> =&gt; <span class="number">5</span>,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;cache&#x27;</span> =&gt; [</span><br><span class="line">            <span class="string">&#x27;enable&#x27;</span>        =&gt; <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&#x27;max_active&#x27;</span>    =&gt; <span class="number">3</span>,</span><br><span class="line">            <span class="string">&#x27;max_wait_time&#x27;</span> =&gt; <span class="number">5</span>,</span><br><span class="line">        ],</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;ipc&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span> =&gt; <span class="string">&#x27;unix_socket&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;lock&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;enable&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>   =&gt; <span class="string">&#x27;table&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;tables&#x27;</span>    =&gt; [],</span><br><span class="line">    <span class="string">&#x27;concretes&#x27;</span> =&gt; [],</span><br><span class="line">    <span class="string">&#x27;resetters&#x27;</span> =&gt; [],</span><br><span class="line">    <span class="string">&#x27;instances&#x27;</span> =&gt; [],</span><br><span class="line">    <span class="string">&#x27;services&#x27;</span>  =&gt; [],</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ§©-äºŒã€WebSocket-äº‹ä»¶ç›‘å¬ç±»"><a href="#ğŸ§©-äºŒã€WebSocket-äº‹ä»¶ç›‘å¬ç±»" class="headerlink" title="ğŸ§© äºŒã€WebSocket äº‹ä»¶ç›‘å¬ç±»"></a>ğŸ§© äºŒã€WebSocket äº‹ä»¶ç›‘å¬ç±»</h2><p>åœ¨ <code>app/webscoket/</code> ç›®å½•ä¸‹æ–°å»ºä»¥ä¸‹ä¸‰ä¸ªç±»ï¼Œåˆ†åˆ«å¯¹åº”è¿æ¥ã€æ¶ˆæ¯ã€æ–­å¼€ä¸‰ä¸ªäº‹ä»¶ã€‚</p>
<h3 id="1-Connect-php-â€”-è¿æ¥äº‹ä»¶"><a href="#1-Connect-php-â€”-è¿æ¥äº‹ä»¶" class="headerlink" title="1. Connect.php â€” è¿æ¥äº‹ä»¶"></a>1. <code>Connect.php</code> â€” è¿æ¥äº‹ä»¶</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">webscoket</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">swoole</span>\<span class="title">Websocket</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Connect</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$websocket</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;websocket = <span class="title function_ invoke__">app</span>(<span class="title class_">Websocket</span>::<span class="variable language_">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$event</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$fd</span> = <span class="variable language_">$this</span>-&gt;websocket-&gt;<span class="title function_ invoke__">getSender</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;websocket-&gt;<span class="title function_ invoke__">push</span>(<span class="title function_ invoke__">json_encode</span>([</span><br><span class="line">            <span class="string">&#x27;type&#x27;</span> =&gt; <span class="string">&#x27;xdebug&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;data&#x27;</span> =&gt; <span class="string">&quot;client <span class="subst">&#123;$fd&#125;</span> Connect&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;time&#x27;</span> =&gt; <span class="title function_ invoke__">time</span>()</span><br><span class="line">        ]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-Event-php-â€”-æ¶ˆæ¯äº‹ä»¶"><a href="#2-Event-php-â€”-æ¶ˆæ¯äº‹ä»¶" class="headerlink" title="2. Event.php â€” æ¶ˆæ¯äº‹ä»¶"></a>2. <code>Event.php</code> â€” æ¶ˆæ¯äº‹ä»¶</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">webscoket</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">swoole</span>\<span class="title">Websocket</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Event</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$websocket</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;websocket = <span class="title function_ invoke__">app</span>(<span class="title class_">Websocket</span>::<span class="variable language_">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$event</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$fd</span> = <span class="variable language_">$this</span>-&gt;websocket-&gt;<span class="title function_ invoke__">getSender</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;client <span class="subst">&#123;$fd&#125;</span> Event\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;æ¥æ”¶åˆ°äº‹ä»¶: &#x27;</span> . <span class="variable">$event</span>-&gt;type . <span class="string">&#x27; --- &#x27;</span> . <span class="variable">$event</span>-&gt;data . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="3-Close-php-â€”-æ–­å¼€äº‹ä»¶"><a href="#3-Close-php-â€”-æ–­å¼€äº‹ä»¶" class="headerlink" title="3. Close.php â€” æ–­å¼€äº‹ä»¶"></a>3. <code>Close.php</code> â€” æ–­å¼€äº‹ä»¶</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">webscoket</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">swoole</span>\<span class="title">Websocket</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Close</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$websocket</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;websocket = <span class="title function_ invoke__">app</span>(<span class="title class_">Websocket</span>::<span class="variable language_">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$event</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$fd</span> = <span class="variable language_">$this</span>-&gt;websocket-&gt;<span class="title function_ invoke__">getSender</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;client <span class="subst">&#123;$fd&#125;</span> Close\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ–¥ï¸-ä¸‰ã€å‰ç«¯-HTML-æµ‹è¯•é¡µé¢"><a href="#ğŸ–¥ï¸-ä¸‰ã€å‰ç«¯-HTML-æµ‹è¯•é¡µé¢" class="headerlink" title="ğŸ–¥ï¸ ä¸‰ã€å‰ç«¯ HTML æµ‹è¯•é¡µé¢"></a>ğŸ–¥ï¸ ä¸‰ã€å‰ç«¯ HTML æµ‹è¯•é¡µé¢</h2><p>æ–°å»ºä¸€ä¸ª HTML æ–‡ä»¶ç”¨äºè°ƒè¯• WebSocket é€šä¿¡ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>websocket<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>websocketåŠŸèƒ½<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;msg&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;send()&quot;</span>&gt;</span>å‘é€<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// wss://echo.websocket.org å…¬å…±æµ‹è¯•æœåŠ¡å™¨</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;ws://ä½ çš„ipåœ°å€:9501&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript">    ws.<span class="property">onopen</span> = <span class="keyword">function</span> (<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¿æ¥æˆåŠŸ&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> sendObj = &#123;&#125;;</span></span><br><span class="line"><span class="language-javascript">        sendObj.<span class="property">type</span> = <span class="string">&#x27;connect&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        sendObj.<span class="property">data</span> = <span class="string">&#x27;connect success&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;msg&#x27;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(sendObj));</span></span><br><span class="line"><span class="language-javascript">        ws.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(sendObj));</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    ws.<span class="property">onclose</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¿æ¥å¤±è´¥&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript">    ws.<span class="property">onmessage</span> = <span class="keyword">function</span> (<span class="params">evt</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ•°æ®å·²æ¥æ”¶&quot;</span>,evt);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">send</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¿è¡Œåˆ°è¿™é‡Œäº†&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> msg = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;msg&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> sendObj = &#123;&#125;;</span></span><br><span class="line"><span class="language-javascript">        sendObj.<span class="property">type</span> = <span class="string">&#x27;mtest&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        sendObj.<span class="property">data</span> = msg;</span></span><br><span class="line"><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;msg&#x27;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(sendObj));</span></span><br><span class="line"><span class="language-javascript">        ws.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(sendObj));</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”—-å‚è€ƒèµ„æ–™"><a href="#ğŸ”—-å‚è€ƒèµ„æ–™" class="headerlink" title="ğŸ”— å‚è€ƒèµ„æ–™"></a>ğŸ”— å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://blog.csdn.net/quweiie/article/details/146481115">ThinkPHP + Swoole WebSocket é…ç½®æ•™ç¨‹ï¼ˆCSDNï¼‰</a></li>
<li><a href="https://wiki.swoole.com/zh-cn/#/websocket_server?id=open_websocket_ping_frame">Swoole å®˜æ–¹æ–‡æ¡£ï¼šWebSocket</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/142404854">çŸ¥ä¹ï¼šThinkPHP + Swoole WebSocket ä½¿ç”¨æ–¹æ³•</a></li>
</ul>
<hr>
<h2 id="âœ…-æ€»ç»“"><a href="#âœ…-æ€»ç»“" class="headerlink" title="âœ… æ€»ç»“"></a>âœ… æ€»ç»“</h2><p>é€šè¿‡æœ¬æ–‡ï¼Œä½ å¯ä»¥å¿«é€Ÿæ­å»ºä¸€ä¸ªåŸºäº Swoole çš„ WebSocket æœåŠ¡ï¼Œå®Œæˆè¿æ¥ã€æ¶ˆæ¯æ¥æ”¶ã€æ–­å¼€ç›‘å¬ç­‰åŸºç¡€åŠŸèƒ½ã€‚ç»“åˆ ThinkPHP çš„äº‹ä»¶æœºåˆ¶ï¼Œè®© WebSocket é›†æˆæ›´æ¸…æ™°ã€æ›´æ˜“æ‰©å±•ã€‚</p>
<p>å¦‚æœä½ æƒ³ç»§ç»­æ·±å…¥ï¼Œå¯ä»¥åŠ å…¥ç”¨æˆ·èº«ä»½ç»‘å®šã€Redis èŠå¤©å®¤ä¸­è½¬ã€æ¶ˆæ¯å¹¿æ’­ç­‰é«˜çº§åŠŸèƒ½ã€‚</p>
]]></content>
  </entry>
</search>
